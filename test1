using Plots
using FFTW
using KrylovKit

#Nos paramétres
struct parameters
    Kmax
    σ
    L
end

P = parameters(100.,0.01,1)

#[0,1,2,3,......Kmax,-1,-2,.....]
Ii =  P.Kmax*2 .* fftfreq(Int64(2*P.Kmax))

Δ = (X -> (4*pi^2/P.L^2) .* X .* (Ii .^2))

#L'abscisse
x = [i*P.L / (2*P.Kmax) - P.L/2 for i in 0:(2*Int64(P.Kmax)-1)]
#println(x)

#Le potentiel
V = - exp.( - (x .^2) ./ P.σ)

#La transformée de fourier du potentiel
FV = fft(V)

#Convolée avec la transformée de fourier de V
CFV = (X -> fft(ifft(X) .* V))

#L'hamiltonien
H = (X -> -Δ(X) + CFV(X))

#Un vecteur pour krylov
ii = [1 for i in 1:2*P.Kmax]

#La résolution
(E,VP) = eigsolve(H,ii)

#La solution
Npsi = sqrt(sum(conj.(VP[1]) .* VP[1]))
println(Npsi)
psi = ifft(VP[1])./ Npsi

println(E)
#println(VP)

#plot(0:(2*Int64(P.Kmax) - 1), real.(ifft(cos.(2*pi .*x))) )

plot(x,real.(conj.(psi) .* psi))
#plot!(x,V)
#plot!(x,real.(ifft(VP[1])))

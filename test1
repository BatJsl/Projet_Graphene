using Plots
using FFTW
using KrylovKit

#Nos paramétres
struct parameters
    Kmax
    σ
    L
end

P = parameters(100.,1.,1.)

#[0,1,2,3,......Kmax,-1,-2,.....]
Ii =  P.Kmax*2 .* fftfreq(Int64(2*P.Kmax))

Δ = (X -> (4*pi^2/P.L^2) .* X .* (Ii .^2))

#L'abscisse
x = [i*P.L / (2*P.Kmax) - P.L/2 for i in 0:(2*Int64(P.Kmax)-1)]
#println(x)

#Le potentiel
V = - exp.( - (x .^2) ./ P.σ)

#La transformée de fourier du potentiel
FV = fft(V)

#Convolée avec la transformée de fourier de V
CFV = (X -> fft(ifft(X) .* V))

#L'hamiltonien
H = (X -> -Δ(X) + CFV(X))

#Un vecteur pour krylov
ii = [1 for i in 1:2*P.Kmax]
ii[Int64(P.Kmax+10)] = 1

#La résolution
res = eigsolve(H,ii)


(E,VP) = res

println(E)
#println(VP)

#plot(0:(2*Int64(P.Kmax) - 1), real.(ifft(cos.(2*pi .*x))) )


plot(x,real.(conj.(ifft(VP[2])) .* ifft(VP[2])))
